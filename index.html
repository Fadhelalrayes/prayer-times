<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>مواقيت الصلاة وفق المذهب الجعفري</title>
  <style>
    :root{--bg:#10151d;--panel:#1b2230;--panel2:#222c40;--txt:#f6f7fb;--muted:#aab3c5;--acc:#ffd369}
    *{box-sizing:border-box} body{margin:0;background:linear-gradient(135deg,#0f1420,#10151d 45%,#0f1420);color:var(--txt);font-family:"Tajawal","Segoe UI",Tahoma,Arial}
    header{position:sticky;top:0;background:#0f1420;border-bottom:1px solid #26324a;padding:18px 10px;text-align:center;z-index:5}
    header h1{margin:0 0 6px;color:var(--acc);font-size:22px}
    header .by{color:var(--muted);font-size:13px}
    .wrap{max-width:960px;margin:18px auto;padding:12px}
    .card{background:linear-gradient(180deg,var(--panel),var(--panel2));border:1px solid #2a3959;border-radius:16px;box-shadow:0 10px 24px rgba(0,0,0,.35);padding:16px}
    .row{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
    label{font-size:13px;color:var(--muted)}
    select,input[type="date"],button{background:#0f1626;color:var(--txt);border:1px solid #2a3959;border-radius:12px;padding:10px 12px;font-size:15px;outline:none}
    select:focus,input[type="date"]:focus{border-color:var(--acc)}
    button{cursor:pointer;background:#0e1a2f;border-color:#375a9e;font-weight:700}
    .btn-ghost{background:transparent;border-color:#3c4b63}
    .status{margin-top:8px;color:var(--muted);font-size:13px;text-align:center}
    table{width:100%;border-collapse:collapse;margin-top:16px;border-radius:12px;overflow:hidden}
    th,td{padding:12px 10px;border-bottom:1px solid #2a3959}
    th{background:#0f1626;color:var(--acc)} tbody tr:nth-child(odd){background:#171f2e}
    footer{max-width:960px;margin:22px auto;color:var(--muted);font-size:13px;text-align:center;border-top:1px dashed #334;padding-top:10px}
  </style>
</head>
<body>
<header>
  <h1>مواقيت الصلاة وفق المذهب الجعفري</h1>
  <div class="by">إعداد وبرمجة: فاضل الريس</div>
</header>

<div class="wrap">
  <div class="card">
    <div class="row">
      <div>
        <label>الدولة</label><br>
        <select id="country"></select>
      </div>
      <div>
        <label>المدينة</label><br>
        <select id="city"></select>
      </div>
      <div>
        <label>التاريخ</label><br>
        <input type="date" id="datePicker" />
      </div>
      <div style="align-self:end">
        <button id="prev" class="btn-ghost">◀ اليوم السابق</button>
        <button id="next" class="btn-ghost">اليوم التالي ▶</button>
        <button id="show">عرض المواقيت</button>
      </div>
    </div>

    <div class="status" id="status">جاهز</div>

    <table>
      <thead><tr><th>الوقت</th><th>الساعة (12h)</th></tr></thead>
      <tbody id="tbody">
        <tr><td>الإمساك</td><td>—</td></tr>
        <tr><td>الفجر</td><td>—</td></tr>
        <tr><td>الشروق</td><td>—</td></tr>
        <tr><td>صلاة الظهر</td><td>—</td></tr>
        <tr><td>الغروب</td><td>—</td></tr>
        <tr><td>صلاة المغرب</td><td>—</td></tr>
        <tr><td>منتصف الليل</td><td>—</td></tr>
      </tbody>
      <tfoot><tr><td colspan="2">طريقة الحساب: الجعفري (Aladhan method=0)</td></tr></tfoot>
    </table>
  </div>
</div>

<footer>جميع الحقوق محفوظة © 2025</footer>

<script>
/* ==== دول ومدن (labels عربية، قيم إنجليزية للـAPI) ==== */
const DATA = [
  { countryEN: 'Bahrain',  countryAR: 'البحرين', cities: [
    {ar:'المنامة', en:'Manama'}
  ]},
  { countryEN: 'Iraq',     countryAR: 'العراق', cities: [
    {ar:'النجف', en:'Najaf'}, {ar:'كربلاء', en:'Karbala'}, {ar:'بغداد', en:'Baghdad'}, {ar:'البصرة', en:'Basrah'}
  ]},
  { countryEN: 'Iran',     countryAR: 'إيران', cities: [
    {ar:'قم', en:'Qom'}, {ar:'مشهد', en:'Mashhad'}, {ar:'طهران', en:'Tehran'}
  ]},
  { countryEN: 'Lebanon',  countryAR: 'لبنان', cities: [
    {ar:'بيروت', en:'Beirut'}, {ar:'صور', en:'Tyre'}
  ]},
  { countryEN: 'Kuwait',   countryAR: 'الكويت', cities: [
    {ar:'مدينة الكويت', en:'Kuwait City'}
  ]},
  { countryEN: 'Pakistan', countryAR: 'باكستان', cities: [
    {ar:'إسلام آباد', en:'Islamabad'}, {ar:'كراتشي', en:'Karachi'}
  ]}
];

const el = {
  country: document.getElementById('country'),
  city: document.getElementById('city'),
  date: document.getElementById('datePicker'),
  prev: document.getElementById('prev'),
  next: document.getElementById('next'),
  show: document.getElementById('show'),
  tbody: document.getElementById('tbody'),
  status: document.getElementById('status')
};

/* ==== أدوات مساعدة ==== */
const to12h = (hhmm) => {
  const [H,M] = hhmm.split(':'); let h = parseInt(H,10);
  const suf = h>=12 ? 'م' : 'ص'; h = h%12; if(h===0) h=12;
  return `${h}:${String(M).padStart(2,'0')} ${suf}`;
};
const setToday = () => { el.date.value = new Date().toISOString().split('T')[0]; };
const shiftDay = (d) => { const x = new Date(el.date.value); x.setDate(x.getDate()+d); el.date.value = x.toISOString().split('T')[0]; };

/* ==== تعبئة القوائم ==== */
function fillCountries(defaultCountryEN='Bahrain'){
  el.country.innerHTML = DATA.map(d=>`<option value="${d.countryEN}">${d.countryAR}</option>`).join('');
  el.country.value = defaultCountryEN; // البحرين افتراضيًا
}
function fillCities(){
  const d = DATA.find(x=>x.countryEN===el.country.value);
  el.city.innerHTML = d.cities.map(c=>`<option value="${c.en}">${c.ar}</option>`).join('');
}

/* ==== رسم الجدول ==== */
function draw(t){
  const rows = [
    ['الإمساك', t.Imsak],
    ['الفجر', t.Fajr],
    ['الشروق', t.Sunrise],
    ['صلاة الظهر', t.Dhuhr],
    ['الغروب', t.Sunset],
    ['صلاة المغرب', t.Maghrib],
    ['منتصف الليل', t.Midnight]
  ];
  el.tbody.innerHTML = rows.map(r=>`<tr><td>${r[0]}</td><td>${to12h(r[1])}</td></tr>`).join('');
}

/* ==== جلب المواقيت من Aladhan (method=0 جعفري) ==== */
async function loadTimes(){
  const city = el.city.value;
  const country = el.country.value; // إنجليزي كما يريده الـAPI
  const date = el.date.value;       // YYYY-MM-DD
  el.status.textContent = `جارِ الجلب لـ ${city}, ${country} — ${date} ...`;
  try{
    const url = `https://api.aladhan.com/v1/timingsByCity/${date}?city=${encodeURIComponent(city)}&country=${encodeURIComponent(country)}&method=0&iso8601=true`;
    const res = await fetch(url, { cache: 'no-store' });
    const json = await res.json();
    if (json.code !== 200) throw new Error('API error');
    draw(json.data.timings);
    el.status.textContent = `تم التحديث: ${city}, ${country} — ${date}`;
  }catch(e){
    console.error(e);
    el.status.textContent = 'تعذر جلب المواقيت. جرّب مدينة/دولة أخرى أو تحقق من الاتصال.';
  }
}

/* ==== ربط الأحداث ==== */
el.country.addEventListener('change', ()=>{ fillCities(); loadTimes(); });
el.city.addEventListener('change', loadTimes);
el.date.addEventListener('change', loadTimes);
el.prev.addEventListener('click', ()=>{ shiftDay(-1); loadTimes(); });
el.next.addEventListener('click', ()=>{ shiftDay(+1); loadTimes(); });
el.show.addEventListener('click', loadTimes);

/* ==== بدء التشغيل ==== */
fillCountries('Bahrain'); // البحرين افتراضيًا
fillCities();
setToday();
loadTimes();
</script>
</body>
</html>
